<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Sydney Grit – Full Rebuild</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
/* --- GLOBAL PAGE STYLING --- */
body {
    margin: 0;
    background: #0c0f12;
    overflow: hidden;
    user-select: none;
    font-family: Arial, sans-serif;
}

canvas {
    display: block;
    margin: 0 auto;
    background: #050607;
}

/* --- HUD TEXT + BARS --- */
#hud {
    position: fixed;
    top: 10px;
    left: 10px;
    color: white;
    z-index: 10;
    font-size: 14px;
    line-height: 1.5;
}

.bar {
    width: 160px;
    height: 10px;
    background: #333;
    margin-bottom: 5px;
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid #000;
}

.bar-inner {
    height: 100%;
    width: 100%;
    background: #55ff55;
    transition: width 0.2s;
}

<meta charset="UTF-8">
<title>Sydney Grit – Giantfile Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body {
        margin: 0;
        background: #0f1014;
        overflow: hidden;
    }
    canvas {
        display: block;
        margin: 0 auto;
        background: #0a0a0a;
    }
    #hud {
        position: fixed;
        top: 10px;
        left: 10px;
        font-family: Arial, sans-serif;
        color: white;
        z-index: 10;
        font-size: 14px;
        user-select: none;
    }
</style>
</head>
<body>

<!-- ========================= -->
<!-- HUD SYSTEM -->
<!-- ========================= -->
<div id="hud">
    <div>Hunger</div><div class="bar"><div id="bar-hunger" class="bar-inner"></div></div>
    <div>Warmth</div><div class="bar"><div id="bar-warmth" class="bar-inner"></div></div>
    <div>Hope</div><div class="bar"><div id="bar-hope" class="bar-inner"></div></div>
    <div>Vice</div><div class="bar"><div id="bar-vice" class="bar-inner"></div></div>

    <div style="margin-top:10px;">
        Cash: <span id="cash">0</span><br>
        Heat: <span id="heat">0</span><br>
        Time Alive: <span id="timer">0</span>s<br>
        Suburb: <span id="suburb">CBD</span>
    </div>
</div>

<!-- ========================= -->
<!-- GAME CANVAS -->
<!-- ========================= -->
<canvas id="game"></canvas>

<script>
/* ============================================================
   PART 1/3 – CORE ENGINE, STRUCTURE, RENDERER, SYSTEM SETUP
   ============================================================ */

/* ---------------------------------------
   CANVAS + CONTEXT SETUP
--------------------------------------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resizeCanvas();
window.onresize = resizeCanvas;

/* ---------------------------------------
   GAME STATE
--------------------------------------- */
const state = {
    // Survival stats
<canvas id="game"></canvas>
<div id="hud">
    <div>Hunger: <span id="hunger">100</span></div>
    <div>Warmth: <span id="warmth">100</span></div>
    <div>Hope: <span id="hope">100</span></div>
    <div>Vice: <span id="vice">0</span></div>
    <div>Cash: <span id="cash">0</span></div>
    <div>Time Alive: <span id="timer">0</span>s</div>
</div>

<script>
// =========================
// CANVAS SETUP
// =========================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// =========================
// GAME STATE
// =========================
let state = {
    hunger: 100,
    warmth: 100,
    hope: 100,
    vice: 0,

    // Economy & pressure
    cash: 0,
    heat: 0,
    timeAlive: 0,

    // Dog state
    dogHunger: 100,
    dogLoyalty: 100,

    // World
    suburb: "CBD",
    weather: "clear",
    timeOfDay: 12, // 0–24 hours

    // Systems
    entities: [],
    events: [],
    particles: [],

    lastFrame: performance.now(),
};

/* ---------------------------------------
   INPUT HANDLER
--------------------------------------- */
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

/* ---------------------------------------
   UTILITIES
--------------------------------------- */
function clamp(v, min, max) {
    return Math.max(min, Math.min(max, v));
}

function rand(a, b) {
    return Math.random() * (b - a) + a;
}

function chance(p) {
    return Math.random() < p;
}

/* ---------------------------------------
   SPRITE BASE64 (HYBRID PIXEL SILHOUETTES)
--------------------------------------- */
const spritePlayer = new Image();
spritePlayer.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAP0lEQVRYhe3OQQ0AAAgDINc/9K3hCEqMwkQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4GQ+DAB4tiTmrAAAAAElFTkSuQmCC";

const spriteDog = new Image();
spriteDog.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAWCAYAAAD5nd/tAAAAPUlEQVRIie3SMQ0AIAwDwYA9/6Wn0hEIjzDk3SCe8x2VIQIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8Br8NAgABNEMY0QAAAABJRU5ErkJggg==";

const spriteNPC = new Image();
spriteNPC.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAPUlEQVRIiWNgGAWjgH3g////MpwYGBiYDBgwGP5z/P///w8GhgYGBtBpgBIMGEAFBgYGhgYGBtC2ICACABmQaL5GsyhWAAAAAElFTkSuQmCC";

const spriteIbis = new Image();
spriteIbis.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAXCAYAAACh+o6PAAAAOklEQVRIie3SQQ0AIAwDsYG9/6VnEECjMCHfYyZf68hIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8G78FBAAAz5FlAQQAAAABJRU5ErkJggg==";

const spriteCop = new Image();
spriteCop.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAhCAYAAADp6C6iAAAARklEQVRIiWNgGAWjgP///8M7MDDw////BwYmBiYGoQYmBgYGH7H8///BgbGBiYGoQZmBgYGLzPwP///x8GhgYGhgYGBgBjOx0lczHxLAAAAABJRU5ErkJggg==";

/* ---------------------------------------
   ENTITY SYSTEM BASE CLASS
--------------------------------------- */
class Entity {
    constructor(x, y, w, h, sprite = null) {
        this.x = x;
        this.y = y;
        this.w = w;
        this.h = h;
        this.sprite = sprite;
    }
    update(dt) {}
    draw(ctx) {
        if (this.sprite) {
            ctx.drawImage(this.sprite, this.x, this.y, this.w, this.h);
        } else {
            ctx.fillStyle = "white";
            ctx.fillRect(this.x, this.y, this.w, this.h);
        }
    }
}

/* ---------------------------------------
   PLAYER
--------------------------------------- */
class Player extends Entity {
    constructor() {
        super(canvas.width/2, canvas.height - 200, 60, 60, spritePlayer);
        this.speed = 220;
    }
    update(dt) {
        if (keys["ArrowLeft"])  this.x -= this.speed * dt;
        if (keys["ArrowRight"]) this.x += this.speed * dt;
        if (keys["ArrowUp"])    this.y -= this.speed * dt;
        if (keys["ArrowDown"])  this.y += this.speed * dt;

        // Boundaries
        this.x = clamp(this.x, 0, canvas.width - this.w);
        this.y = clamp(this.y, 0, canvas.height - 200);
    }
}

/* ---------------------------------------
   DOG (FOLLOWER)
--------------------------------------- */
class Dog extends Entity {
    constructor(player) {
        super(player.x - 80, player.y, 40, 40, spriteDog);
        this.player = player;
    }
    update(dt) {
        // Follow logic
        this.x += (this.player.x - this.x) * 0.05;
        this.y += (this.player.y - this.y) * 0.05;
    }
}

/* ---------------------------------------
   NPC BASE
--------------------------------------- */
class NPC extends Entity {
    constructor(x, y) {
        super(x, y, 50, 50, spriteNPC);
        this.speed = rand(40, 70);
    }
    update(dt) {
        this.x -= this.speed * dt;
        if (this.x < -200) this.dead = true;
    }
}

/* ---------------------------------------
   IBIS
--------------------------------------- */
class Ibis extends Entity {
    constructor() {
        super(canvas.width + 60, canvas.height - 210, 50, 40, spriteIbis);
        this.speed = rand(30, 60);
    }
    update(dt) {
        this.x -= this.speed * dt;
        if (this.x < -100) this.dead = true;
    }
}

/* ---------------------------------------
   POLICE (CHASERS)
--------------------------------------- */
class Cop extends Entity {
    constructor(target) {
        super(canvas.width + 100, target.y, 60, 60, spriteCop);
        this.target = target;
        this.speed = 180;
        this.tripping = false;
        this.tripTimer = 0;
    }
    update(dt) {
        if (!this.tripping) {
            this.x -= this.speed * dt;
            if (chance(0.001)) {
                this.tripping = true;
                this.tripTimer = 0.7; // seconds
            }
        } else {
            this.tripTimer -= dt;
            if (this.tripTimer <= 0) this.dead = true;
        }

        // Collision with player → punish
        if (Math.abs(this.x - this.target.x) < 40 &&
            Math.abs(this.y - this.target.y) < 40) {
            state.hope -= 8;
            state.heat += 10;
            this.dead = true;
        }
    }
}

/* ---------------------------------------
   ADD INITIAL ENTITIES (PLAYER + DOG)
--------------------------------------- */
const player = new Player();
const dog = new Dog(player);
state.entities.push(player, dog);

</script>
    cash: 0,
    timeAlive: 0,
    entities: [],
    events: [],
};

// HUD UPDATE
function updateHUD() {
    document.getElementById("hunger").textContent = state.hunger;
    document.getElementById("warmth").textContent = state.warmth;
    document.getElementById("hope").textContent = state.hope;
    document.getElementById("vice").textContent = state.vice;
    document.getElementById("cash").textContent = state.cash;
    document.getElementById("timer").textContent = state.timeAlive;
}

// =========================
// PLAYER
// =========================
const player = {
    x: canvas.width / 2,
    y: canvas.height - 180,
    w: 60,
    h: 60,
    speed: 4,
    color: "#5af",
};

state.entities.push(player);

// =========================
// DOG FOLLOWER
// =========================
const dog = {
    x: player.x - 100,
    y: player.y,
    w: 40,
    h: 40,
    color: "#d9a",
    follow() {
        this.x += (player.x - this.x) * 0.05;
        this.y += (player.y - this.y) * 0.05;
    }
};
state.entities.push(dog);

// =========================
// RANDOM NPC (street characters)
// =========================
function spawnNPC() {
    const npc = {
        x: canvas.width + 50,
        y: canvas.height - 180,
        w: 50,
        h: 50,
        speed: Math.random() * 1 + 0.5,
        color: "#ccc",
        update() {
            this.x -= this.speed;
        }
    };
    state.entities.push(npc);
}

setInterval(() => {
    spawnNPC();
}, 1800);

// =========================
// POLICE CHASE EVENT
// =========================
function spawnPolice() {
    const cop = {
        x: canvas.width + 100,
        y: player.y,
        w: 60,
        h: 60,
        speed: 6,
        color: "#3af",
        update() {
            this.x -= this.speed;
            if (Math.abs(this.x - player.x) < 50) {
                // Player caught
                state.hope -= 20;
            }
        }
    };
    state.entities.push(cop);
}

setInterval(() => {
    if (Math.random() < 0.2) spawnPolice();
}, 5000);

// =========================
// INPUT
// =========================
const keys = {};

window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// =========================
// RANDOM ENCOUNTERS
// =========================
function randomEvent() {
    const roll = Math.random();

    // Street deal (legal abstract)
    if (roll < 0.33) {
        state.cash += 5;
        state.vice += 2;
    }
    // Helpful stranger
    else if (roll < 0.66) {
        state.hope += 5;
        state.warmth += 5;
    }
    // Dangerous encounter
    else {
        state.hope -= 10;
        state.hunger -= 5;
    }
}

setInterval(randomEvent, 7000);

// =========================
// SURVIVAL DECAY
// =========================
setInterval(() => {
    state.hunger -= 1;
    state.warmth -= 1;
    state.hope -= 0.5;
    state.vice = Math.max(0, state.vice - 0.5);
    state.timeAlive += 1;

    if (state.hunger <= 0 || state.warmth <= 0 || state.hope <= 0) {
        alert("Game Over — You survived " + state.timeAlive + " seconds.");
        location.reload();
    }

}, 1000);

// =========================
// GAME LOOP
// =========================
function loop() {
    updateHUD();

    // Background
    ctx.fillStyle = "#1a1d22";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Street
    ctx.fillStyle = "#222";
    ctx.fillRect(0, canvas.height - 150, canvas.width, 150);

    // Player movement
    if (keys["ArrowLeft"]) player.x -= player.speed;
    if (keys["ArrowRight"]) player.x += player.speed;
    if (keys["ArrowUp"]) player.y -= player.speed;
    if (keys["ArrowDown"]) player.y += player.speed;

    // Clamp player
    player.x = Math.max(0, Math.min(canvas.width - player.w, player.x));
    player.y = Math.max(0, Math.min(canvas.height - 200, player.y));

    // Dog follow
    dog.follow();

    // Draw all entities
    state.entities.forEach(e => {
        if (e.update) e.update();
        ctx.fillStyle = e.color;
        ctx.fillRect(e.x, e.y, e.w, e.h);
    });

    requestAnimationFrame(loop);
}

loop();

/* ============================================================
   PART 2/3 – WORLD SYSTEM, PARALLAX, SUBURBS, WEATHER, DAY/NIGHT
   ============================================================ */

/* ---------------------------------------
   WORLD BACKGROUND LAYERS (PARALLAX)
--------------------------------------- */

const bgLayers = {
    sky:    { color: "#1a1d22", speed: 0 },
    far:    { offset: 0, speed: 10, img: null },
    mid:    { offset: 0, speed: 40, img: null },
    near:   { offset: 0, speed: 80, img: null },
    street: { offset: 0, speed: 140, img: null }
};

/* Base64 simple skyline layers (abstract silhouettes) */
bgLayers.far.img = new Image();
bgLayers.far.img.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZAAAABkCAYAAABZECYIAAAAOElEQVR4nO3BAQ0AAADCoPdPbQ8HFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwJgeHAAHg0BdXAAAAAElFTkSuQmCC";

bgLayers.mid.img = new Image();
bgLayers.mid.img.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXAAAAA/CAYAAAB2k8WcAAAAN0lEQVR4nO3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEODceQAHYrKTVAAAAAElFTkSuQmCC";

bgLayers.near.img = new Image();
bgLayers.near.img.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWAAAABUCAYAAAA1sr1FAAAAPElEQVR4nO3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEODceQAHYrKTVAAAAAElFTkSuQmCC";

bgLayers.street.img = new Image();
bgLayers.street.img.src =
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYAAAABMCAYAAACvC/P8AAAAO0lEQVR4nO3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEODceQAHYrKTVAAAAAElFTkSuQmCC";

/* ---------------------------------------
   SUBURB DEFINITIONS
--------------------------------------- */
const suburbs = [
    { name: "CBD",         danger: 1, colorTint: "rgba(0,0,0,0.15)" },
    { name: "Kings Cross", danger: 2, colorTint: "rgba(60,0,0,0.20)" },
    { name: "Surry Hills", danger: 1.2, colorTint: "rgba(0,30,0,0.15)" },
    { name: "Chinatown",   danger: 1.5, colorTint: "rgba(40,40,0,0.20)" },
    { name: "Cabramatta",  danger: 1.7, colorTint: "rgba(30,0,30,0.20)" },
    { name: "Parramatta",  danger: 1.1, colorTint: "rgba(0,0,50,0.15)" },
    { name: "Mt Druitt",   danger: 3, colorTint: "rgba(50,0,50,0.25)" }
];

let currentSuburbIndex = 0;

/* Scroll counter to trigger suburb transitions */
let worldScroll = 0;
const suburbLength = 6000; // pixels to scroll before shifting suburb

/* ---------------------------------------
   WEATHER SYSTEM
--------------------------------------- */
const weather = {
    type: "clear",
    timer: 0,
    particles: []
};

function updateWeather(dt) {
    weather.timer -= dt;
    if (weather.timer <= 0) {
        const roll = Math.random();
        if (roll < 0.6) weather.type = "clear";
        else if (roll < 0.8) weather.type = "rain";
        else weather.type = "storm";

        weather.timer = rand(20, 60); // seconds
    }

    // Rain particles
    if (weather.type === "rain" || weather.type === "storm") {
        for (let i = 0; i < 10; i++) {
            weather.particles.push({
                x: rand(0, canvas.width),
                y: -10,
                speed: rand(200, 400)
            });
        }
    }

    weather.particles.forEach(p => {
        p.y += p.speed * dt;
        if (p.y > canvas.height) p.dead = true;
    });
    weather.particles = weather.particles.filter(p => !p.dead);
}

/* ---------------------------------------
   DAY / NIGHT CYCLE
--------------------------------------- */
function updateTimeOfDay(dt) {
    state.timeOfDay += dt * 0.1; // slow cycle

    if (state.timeOfDay >= 24) state.timeOfDay -= 24;
}

function applyTimeTint() {
    // Night darkness
    let tint = 0;
    if (state.timeOfDay >= 20 || state.timeOfDay <= 5) tint = 0.5; // dark night
    else if (state.timeOfDay >= 17 && state.timeOfDay < 20) tint = 0.3; // dusk
    else if (state.timeOfDay >= 5 && state.timeOfDay < 8)  tint = 0.2; // dawn

    ctx.fillStyle = `rgba(0,0,0,${tint})`;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
}

/* ---------------------------------------
   PARALLAX RENDERING
--------------------------------------- */
function renderParallax(dt) {
    // Move layers based on player movement
    let speedFactor = (keys["ArrowLeft"] ? -1 : keys["ArrowRight"] ? 1 : 0);

    for (const key in bgLayers) {
        const layer = bgLayers[key];
        if (layer.speed > 0) {
            layer.offset += layer.speed * dt * speedFactor;
            if (layer.offset < -canvas.width) layer.offset += canvas.width;
            if (layer.offset > canvas.width) layer.offset -= canvas.width;

            // Draw twice for seamless scroll
            ctx.drawImage(layer.img, layer.offset, canvas.height - layer.img.height - 180);
            ctx.drawImage(layer.img, layer.offset + canvas.width, canvas.height - layer.img.height - 180);
        }
    }

    // Street layer
    ctx.drawImage(bgLayers.street.img, 0, canvas.height - 160, canvas.width, 160);
}

/* ---------------------------------------
   SUBURB TRANSITIONS
--------------------------------------- */
function updateSuburb(dt) {
    // Scroll accumulates as player moves horizontally
    if (keys["ArrowRight"]) worldScroll += dt * 200;
    if (keys["ArrowLeft"]) worldScroll -= dt * 200;

    if (Math.abs(worldScroll) > suburbLength) {
        worldScroll = 0;
        currentSuburbIndex = (currentSuburbIndex + 1) % suburbs.length;
        state.suburb = suburbs[currentSuburbIndex].name;
    }
}

/* ---------------------------------------
   HUD UPDATE
--------------------------------------- */
function updateHUD() {
    document.getElementById("bar-hunger").style.width = state.hunger + "%";
    document.getElementById("bar-warmth").style.width = state.warmth + "%";
    document.getElementById("bar-hope").style.width = state.hope + "%";
    document.getElementById("bar-vice").style.width = state.vice + "%";

    document.getElementById("cash").textContent = state.cash;
    document.getElementById("heat").textContent = state.heat;
    document.getElementById("timer").textContent = state.timeAlive;
    document.getElementById("suburb").textContent = state.suburb;
}
</script>

</body>
</html>
